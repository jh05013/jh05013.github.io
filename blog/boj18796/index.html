<!doctype html><html lang=en xmlns=http://www.w3.org/1999/xhtml><head><meta charset=UTF-8><meta name=description><meta content="width=device-width,initial-scale=1" name=viewport><meta content=#9a9996 name=theme-color><meta content="default-src 'none';font-src 'self';img-src 'self' https: data:;media-src 'self' https:;style-src 'self' 'unsafe-inline';frame-src https://player.vimeo.com https://www.youtube-nocookie.com https://toot.community;base-uri 'none';form-action 'none';connect-src 'self' https://toot.community;script-src 'self' 'self'" http-equiv=content-security-policy><title>BOJ 18796 이동하기 4 - jh05013</title><link href=https://jh05013.github.io/blog/boj18796/ rel=canonical><link href=https://jh05013.github.io/favicon.png rel=icon type=image/png><link href=https://jh05013.github.io/apple-touch-icon.png rel=apple-touch-icon sizes=180x180 type=image/png><link title="jh05013 - RSS Feed" href=https://jh05013.github.io/rss.xml rel=alternate type=application/rss+xml><link title="jh05013 - Atom Feed" href=https://jh05013.github.io/atom.xml rel=alternate type=application/atom+xml><style>:root{--accent-color:#6f8396;--contrast-color:#fff}</style><link href=https://jh05013.github.io/style.css rel=stylesheet><link href=https://jh05013.github.io/katex.css rel=stylesheet><link href=https://jh05013.github.io/mods.css rel=stylesheet><link media="(prefers-color-scheme: light)" href=https://jh05013.github.io/syntax-theme-light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://jh05013.github.io/syntax-theme-dark.css rel=stylesheet><script defer src=https://jh05013.github.io/closable.js></script><script defer src=https://jh05013.github.io/copy-button.js></script><script defer src=https://jh05013.github.io/katex.min.js></script><script defer src=https://jh05013.github.io/auto-render.min.js></script><script defer src=https://jh05013.github.io/katex-init.js></script><script defer src=https://jh05013.github.io/fuse.js></script><script defer src=https://jh05013.github.io/search-fuse.js></script><script defer src=https://jh05013.github.io/theme-switcher.js></script><meta content=jh05013 property=og:site_name><meta content="BOJ 18796 이동하기 4 - jh05013" property=og:title><meta content=https://jh05013.github.io/blog/boj18796/ property=og:url><meta property=og:description><meta content=https://jh05013.github.io/card.png property=og:image><meta content=en_US property=og:locale><body><header id=site-nav><nav><a href=#main-content tabindex=0> Skip to Main Content </a><ul><li id=home><a href=https://jh05013.github.io> <i class=icon></i>jh05013</a><li class=divider><li><details class=closable><summary>Links</summary> <ul><li><a href=https://jh05013.github.io/about/>About</a><li><a href=https://jh05013.github.io/blog/>Blog</a></ul></details><li id=search><button class=circle id=search-toggle title=Search><i class=icon></i></button><li id=theme-switcher><details class=closable><summary class=circle title=Theme><i class=icon></i></summary> <ul><li><button title="Switch to Light Theme" class=circle id=theme-light><i class=icon></i></button><li><button title="Switch to Dark Theme" class=circle id=theme-dark><i class=icon></i></button><li><button title="Use System Theme" class=circle id=theme-system><i class=icon></i></button></ul></details><li id=feed><details class=closable><summary class=circle title=Feed><i class=icon></i></summary> <ul><li><a href=https://jh05013.github.io/rss.xml>RSS</a><li><a href=https://jh05013.github.io/atom.xml>Atom</a></ul></details><li id=repo><a class=circle href=https://github.com/jh05013/jh05013.github.io title=Repository> <i class=icon></i> </a></ul></nav><div id=search-container><label class=visually-hidden for=search-bar>Search</label><input placeholder="Search for…" autocomplete=off disabled id=search-bar type=search><div id=search-results-container><div id=search-results></div></div></div></header><main id=main-content><article><div id=heading><p><small> <time datetime=" 2022-06-04T00:00:00+00:00">Published on June 04, 2022</time></small><h1>BOJ 18796 이동하기 4</h1><p><small><span>6 minutes read</span><span> • </span></small><ul class=tags><li><a class=tag href=https://jh05013.github.io/tags/ps-solution/>ps-solution</a></ul></div><div id=buttons-container><a title="Go to Top" href=#top id=go-to-top><i class=icon></i></a><a title="File an Issue" href=https://github.com/jh05013/jh05013.github.io id=issue><i class=icon></i></a></div><p><a href=https://acmicpc.net/problem/18796>https://acmicpc.net/problem/18796</a><pre class=z-code><code><span class="z-text z-plain">60  +---+---+---+       +60-+60-+60-+
</span><span class="z-text z-plain">    |   |   |   |       10  90  80  70
</span><span class="z-text z-plain">20  +---+---+---+       +20-+20-+20-+
</span><span class="z-text z-plain">    |   |   |   |       10  90  80  70
</span><span class="z-text z-plain">90  +---+---+---+       +90-+90-+90-+
</span><span class="z-text z-plain">    10  90  80  70
</span></code></pre><p>예제 입력 1과 각 이동의 비용을 그림으로 나타내면 위와 같습니다. 출력은 $10 + 20 + 20 + 20 + 70 = 140$입니다.<h1 id=munjeyi-jaeguseong>문제의 재구성</h1><p>먼저, 생각하기 쉽도록 문제를 조금 변형해 봅시다.<p>맨 처음에 경로 하나가 주어집니다. 이 경로는 아래로 쭉 이동한 다음 오른쪽으로 쭉 이동합니다.<pre class=z-code><code><span class="z-text z-plain">60  +
</span><span class="z-text z-plain">    |
</span><span class="z-text z-plain">20  +
</span><span class="z-text z-plain">    |
</span><span class="z-text z-plain">90  +---+---+--->
</span><span class="z-text z-plain">    10  90  80  70
</span></code></pre><p>이 경로가 아래, 오른쪽 순서로 지나간 칸이 있으면 이 칸을 오른쪽, 아래 순서로 지나가도록 경로를 변경할 수 있습니다. 이때 경로의 비용도 변화하는데, 그 변화량은 인접한 두 $B_c$ 값의 차와 인접한 두 $A_r$ 값의 차를 합하여 계산할 수 있습니다.<pre class=z-code><code><span class="z-text z-plain">60  +
</span><span class="z-text z-plain">    |
</span><span class="z-text z-plain">20  +---+          cost = (20-90) + (90-10)
</span><span class="z-text z-plain">        |               = 10
</span><span class="z-text z-plain">90      +---+--->
</span><span class="z-text z-plain">    10  90  80  70
</span></code></pre><p>이제 문제는 이렇게 바뀝니다.<ul><li>격자가 있습니다. 칸 $(x, y)$를 칠하는 비용은 $Cost[x,y] := R[x] + C[y]$입니다.<li>몇 개의 칸을 색칠할 건데, 색칠한 칸은 첫 열부터 마지막 열까지 높이가 단조감소하는 히스토그램을 이루어야 합니다.<li>비용을 최소화하세요.<li>편의를 위해, 비용이 최소이더라도 칸을 더 칠하면서 비용을 유지시킬 수 있다면 최적해가 아니라고 간주합시다.</ul><p>이 최소 비용을 계산한 다음, 초기 경로의 비용에 더하면 원래 문제의 답을 얻습니다.<pre class=z-code><code><span class="z-text z-plain">    +---+---+---+
</span><span class="z-text z-plain"> 40 |120|30 |30 |
</span><span class="z-text z-plain">    +---+---+---+
</span><span class="z-text z-plain">-70 |10 |-80|-80|
</span><span class="z-text z-plain">    +---+---+---+
</span><span class="z-text z-plain">     80  -10 -10
</span></code></pre><p>예제 입력 1을 히스토그램 버전으로 재구성하면 위와 같이 됩니다. $R$은 (-70, 40), $C$는 (80, -10, -10)입니다. 이 문제의 최적해는 아래 세 칸을 칠하는 것으로 -150의 비용이 들고, 초기 경로의 비용은 $10 \times 2 + 90 \times 3 = 290$이므로 출력은 $290 - 150 = 140$입니다.<h1 id=myeoc-gaji-gwancal>몇 가지 관찰</h1><p>우선 첫 번째 열부터 봅시다. 최적해에서 첫 번째 열의 높이가 $i$라고 합시다. 즉 $(1, 1), (2, 1), \cdots, (i, 1)$을 칠했고 $(i+1, 1)$은 칠하지 않은 상태입니다.<p>그러면 다음이 성립합니다.<ul><li>$Cost[i+1, 1] > 0$. 안 그러면 $(i+1, 1)$을 칠하지 않을 이유가 없습니다.<li>만약 두 번째 열이 $i$층을 칠하지 않았다면, $Cost[i, 1] \leq 0 \wedge Cost[i, 2] > 0$. 첫 번째 부등식이 성립하지 않으면 $(i, 1)$을 지우는 것이 더 좋고, 두 번째 부등식이 성립하지 않으면 $(i, 2)$를 칠하는 것이 더 좋습니다.<li>만약 두 번째 열도 $i$층을 칠했다면, $Cost[i+1,1] + Cost[i+1,2] > 0$. 안 그러면 $(i, 1)$과 $(i, 2)$를 칠하지 않는 것이 더 좋습니다.</ul><pre class=z-code><code><span class="z-text z-plain">   +---+---+---+      +---+---+---+
</span><span class="z-text z-plain">i+1|   |   |   |   i+1|   |   |   |
</span><span class="z-text z-plain">   +---+---+---+      +---+---+---+
</span><span class="z-text z-plain">i  |###|   |   |   i  |###|###|   |
</span><span class="z-text z-plain">   +---+---+---+      +---+---+---+
</span><span class="z-text z-plain">i-1|###|   |   |   i+1|###|###|   |
</span><span class="z-text z-plain">   +---+---+---+      +---+---+---+
</span><span class="z-text z-plain">   |###|###|   |      |###|###|   |
</span><span class="z-text z-plain">   +---+---+---+      +---+---+---+
</span><span class="z-text z-plain">    1   2              1   2
</span></code></pre><h2 id=ilbanhwa>일반화</h2><p>이를 일반화해봅시다. 만약 1, 2, 3, …, $k$번째 열이 정확히 $i$층까지 칠했고 $k+1$번째 열이 $i$층을 칠하지 않았다면,<ul><li>$Cost[i, 1] + \cdots + Cost[i, k] \leq 0$. 안 그러면 $(i, 1), \cdots, (i, k)$를 지우는 것이 더 좋습니다.<li>$Cost[i+1, 1] + \cdots + Cost[i+1, k] > 0$. 안 그러면 $(i+1, 1), \cdots, (i+1, k)$를 칠하는 것이 더 좋습니다.</ul><pre class=z-code><code><span class="z-text z-plain">   +---+---+---+---+---+
</span><span class="z-text z-plain">i+1|   |   |   |   |   |
</span><span class="z-text z-plain">   +---+---+---+---+---+
</span><span class="z-text z-plain">i  |###|###|###|   |   |
</span><span class="z-text z-plain">   +---+---+---+---+---+
</span><span class="z-text z-plain">i-1|###|###|###|###|   |
</span><span class="z-text z-plain">   +---+---+---+---+---+
</span><span class="z-text z-plain">   |###|###|###|###|###|
</span><span class="z-text z-plain">   +---+---+---+---+---+
</span><span class="z-text z-plain">    1       k   k+1
</span></code></pre><h2 id=geureomyeon-mueoseul-al-su-issnayo>그러면 무엇을 알 수 있나요?</h2><p>두 부등식을 정리하면 $kR[i] + C[1] + \cdots + C[k] \leq 0 < kR[i+1] + C[1] + \cdots + C[k]$이므로, $R[i] < R[i+1]$임을 알 수 있습니다. 히스토그램을 어떻게 칠하든 위에서 제시한 $k$는 반드시 존재하므로, 이는 **최적해의 첫 번째 열이 정확히 $i$층까지 칠했다면 $R[i] < R[i+1]$**임을 의미합니다. 그리고 이 관찰은 꼭 첫 번째 열에서만 적용되는 건 아닙니다. **최적해의 어느 열이 정확히 $i$층까지 칠했을 경우, $R[i] < R[i+1]$**입니다.<p>반대로 말하면, <strong>$R[i] \geq R[i+1]$이면 $i$층에서 멈출 일이 없습니다</strong>. 즉 어떤 열이든 i층을 칠하면 i+1층도 반드시 칠해야 합니다.<h1 id=geureomeuro-iceungeul-jiubsida>그러므로 i층을 지웁시다</h1><p>$R[i] \geq R[i+1]$이라면 $i$층과 $i+1$층을 아예 “합체“해줍시다. 즉<ul><li>기존의 $R$ 배열이 $[R[1], \cdots, R[i], R[i+1], R[i+2], \cdots, R[N]]$이었다면,<li>새로운 $R$ 배열은 $[R[1], \cdots, R[i] + R[i+1], R[i+2], \cdots, R[N]]$이 됩니다.</ul><p>그런데 이렇게 그냥 합체해 버리면 칸을 칠하는 비용이 전과 맞지 않게 됩니다. 왜냐하면 합체 전에 $(i, 1)$과 $(i+1, 1)$을 칠하는 비용은 $R[i] + R[i+1] + 2C[1]$이었는데, 합체 후에 $(i, 1)$을 칠하는 비용은 $R[i] + R[i+1] + C[1]$이기 때문입니다.<h2 id=haegyeol-bangbeob>해결 방법</h2><p>이를 해결하기 위해, 각 층마다 <strong>높이</strong> 값을 도입합니다. $i$층의 높이를 $H[i]$라고 할 때, $Cost[i, j] := R[i] + H[i]C[j]$로 정의하고, 두 층을 합칠 때는 $R$과 $H$ 값을 모두 합치면 됩니다.<pre class=z-code><code><span class="z-text z-plain">   +---+---+---+---+---+
</span><span class="z-text z-plain">i  |###|###|###|   |   |
</span><span class="z-text z-plain">   |###|###|###|   |   |
</span><span class="z-text z-plain">   +---+---+---+---+---+
</span><span class="z-text z-plain">i-1|###|###|###|###|   |
</span><span class="z-text z-plain">   +---+---+---+---+---+
</span><span class="z-text z-plain">   |###|###|###|###|###|
</span><span class="z-text z-plain">   +---+---+---+---+---+
</span><span class="z-text z-plain">    1       k   k+1
</span></code></pre><h2 id=myeoc-gaji-gwancal-v2>몇 가지 관찰 v2</h2><p>이제 위에서 본 그리디 전략을 다시 적용해 봅시다. 만약 1, 2, 3, …, $k$번째 열이 정확히 $i$층까지 칠했고 $k+1$번째 열이 $i$층을 칠하지 않았다면,<ul><li>$Cost[i, 1] + \cdots + Cost[i, k] = kR[i] + H[i]\mathscr{C} \leq 0$ ($\mathscr{C} := C[1] + \cdots + C[k]$).<li>$Cost[i+1, 1] + \cdots + Cost[i+1, k] = kR[i+1] + H[i+1]\mathscr{C} > 0$.</ul><p>따라서 $k \frac{R[i]}{H[i]} + \mathscr{C} \leq 0 < k \frac{R[i+1]}{H[i+1]} + \mathscr{C}$이므로, $\frac{R[i]}{H[i]} < \frac{R[i+1]}{H[i+1]}$입니다. 같은 이유로, $\frac{R[i]}{H[i]} \geq \frac{R[i+1]}{H[i+1]}$이면 $i$층과 $i+1$층을 합체해줄 수 있습니다.<h1 id=eoddeohge-habcehaeya-haneunga>어떻게 합체해야 하는가?</h1><p>이제 우리가 할 일은 $\frac{R[i]}{H[i]} \geq \frac{R[i+1]}{H[i+1]}$인 $i$를 찾아 합체하는 과정을 이러한 $i$가 존재하지 않을 때까지 반복하는 것입니다. 그런데 이러한 $i$가 여러 개라면 무엇을 먼저 합체해야 할까요?<p>그 답은… 상관없습니다. <strong>어떤 순서로 합체를 하더라도 최종적으로는 똑같은 배열이 됩니다.</strong> 왜일까요? $H$의 누적합을 $x$좌표, $R$의 누적합을 $y$좌표로 두고 점을 찍어봅시다.<p><img alt src=/images/move41.png><p>각각의 $H[i]$, $R[i]$ 쌍은 $i$번째와 $i+1$번째 점을 잇는 선분에 해당되고, 어떤 $i$에 대해 $i$번째 선분의 기울기가 $i+1$번째 선분의 기울기보다 크거나 같으면 $i+1$번째 점을 제거할 수 있습니다. 최종적으로는 선분들의 기울기가 단조증가하게 됩니다. 따라서, 어떤 순서로 합체를 하더라도 결국에는 아래로 볼록한 볼록 껍질만 남습니다.<p>합체 과정은 monotone chain 알고리즘처럼 스택으로 구현할 수 있습니다.<p><img alt src=/images/move42.png><p>이렇게 분수를 직선의 기울기로 생각하는 발상은 <a href=https://www.acmicpc.net/problem/16760>이 문제</a>, <a href=https://www.acmicpc.net/problem/12122>이 문제</a>, <a href=https://codeforces.com/contest/1300/problem/E>이 문제</a> 등에서도 쓸 수 있습니다.<h1 id=yeol-habce>열 합체</h1><p>지금까지의 논리를 $C$에도 적용할 수 있습니다. 각 열마다 <strong>너비</strong> $W[j]$ 값을 도입하고, $Cost[i, j] := R[i]W[j] + C[j]H[i]$로 정의한 뒤, $\frac{C[j]}{W[j]}$ 값이 단조증가하도록 열을 합쳐 줍시다.<p>거의 다 왔습니다!<h1 id=bunhae>분해</h1><p>이제 아주 중요한 일이 일어납니다. 볼록 껍질의 둘레를 따라 각 $x$좌표마다 다시 점을 찍어서 볼록 껍질을 다시 $N$개의 선분으로 분해해 봅시다.<p><img alt src=/images/move43.png><p>그러면 볼록 껍질은 바뀌지 않았기 때문에 최적해도 바뀌지 않습니다. 선분들의 기울기는 여전히 단조증가합니다. 그런데 이제 모든 $H[i]$가 1이기 때문에, 이는 $R[i]$가 단조증가함을 의미합니다. 마찬가지로 모든 $W[j]$가 1이면서 $C[j]$도 단조증가하도록 바꿀 수 있습니다. 답을 바꾸지 않으면서 $R$과 $C$가 단조증가한다는 매우 강력한 조건을 추가한 것입니다.<h2 id=mamuri>마무리</h2><p>이제 나머지는 간단합니다. $Cost[i, j] > 0$이라면 $Cost[i+1, j]$와 $Cost[i, j+1]$도 모두 양수이기 때문에, $Cost[i, j] \leq 0$인 모든 $(i, j)$는 높이가 단조감소하는 히스토그램의 형태를 갖습니다. <strong>따라서 그 히스토그램이 그냥 최적해입니다.</strong> 히스토그램 및 비용은 투 포인터와 누적합으로 찾을 수 있습니다.</article><hr><nav id=post-nav><a class="post-nav-item post-nav-prev" href=https://jh05013.github.io/blog/boj5811/> <div class=nav-arrow>Previous</div> <span class=post-title>IOI 2012-1-2 낙하산 고리들</span> </a><a class="post-nav-item post-nav-next" href=https://jh05013.github.io/blog/shape-union/> <div class=nav-arrow>Next</div> <span class=post-title>도형의 합집합과 넓이</span> </a></nav><span class=hidden id=copy-code-text>Copy Code</span><span class=hidden id=search-index>https://jh05013.github.io/search_index.en.json</span><span class=hidden id=more-matches-text>$MATCHES more matches</span></main><footer id=site-footer><nav><ul><li><a href=https://jh05013.github.io/about/>About</a><li><a href=https://jh05013.github.io/blog/>Blog</a></ul></nav><p>© jh05013, 2025<p><small>Powered by <a class="link external" href=https://www.getzola.org>Zola</a> and <a class="link external" href=https://duckquill.daudix.one>Duckquill</a> </small><ul id=socials><li><a rel=" me" href=https://github.com/jh05013 title=GitHub> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EGitHub%3C/title%3E%3Cpath d='M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12'/%3E%3C/svg%3E&#34)" class=icon></i> <span>GitHub</span> </a><li><a rel=" me" href=https://bsky.app/profile/jh05013.bsky.social title=Bluesky> <i style="--icon:url(&#34data:image/svg+xml,%3Csvg role='img' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Ctitle%3EBluesky%3C/title%3E%3Cpath d='M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479.815 2.736 3.713 3.66 6.383 3.364.136-.02.275-.039.415-.056-.138.022-.276.04-.415.056-3.912.58-7.387 2.005-2.83 7.078 5.013 5.19 6.87-1.113 7.823-4.308.953 3.195 2.05 9.271 7.733 4.308 4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741 0 0 1-.415-.056c.14.017.279.036.415.056 2.67.297 5.568-.628 6.383-3.364.246-.828.624-5.79.624-6.478 0-.69-.139-1.861-.902-2.206-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8Z'/%3E%3C/svg%3E&#34)" class=icon></i> <span>Bluesky</span> </a></ul></footer>